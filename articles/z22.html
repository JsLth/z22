<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get started with z22 • z22</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get started with z22">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">z22</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Overview</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/z22.html"><span class="fa fa-book"></span> Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-search"></span> Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jslth/z22/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get started with z22</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jslth/z22/blob/v1.0.3/vignettes/z22.Rmd" class="external-link"><code>vignettes/z22.Rmd</code></a></small>
      <div class="d-none name"><code>z22.Rmd</code></div>
    </div>

    
    
<style>
    img {
        border: none;
    }
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jslth/z22/" class="external-link">z22</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<p>The German <a href="https://www.zensus2022.de/" class="external-link">2022 census</a> marks
the second German census for which spatial census data is published at a
grid level. While some progress has been made in the way the data is
processed, it is still only available as <a href="https://www.zensus2022.de/EN/Census_results/" class="external-link">CSV dumps</a>.
Working with these data programmatically can be quite burdensome.
<a href="https://github.com/jslth/z22/" class="external-link">z22</a> aims to make it easier to read and process census
grid data from both 2022 and 2011 censuses. The functions establish a
standardized feature language that can translate data from 2011 to 2022,
and vice versa. It relies on preprocessed parquet chunks from the <a href="https://github.com/JsLth/z22data/" class="external-link"><code>z22data</code></a> data
repository where the data chunks are stored. The package is a successor
of Stefan Jüngers <a href="https://stefanjuenger.github.io/z11/" class="external-link"><code>z11</code></a>
package.</p>
<p>Data chunks are uniquely identified using <strong>features</strong>
and <strong>categories</strong>. When I talk about a <em>feature</em>, I
talk about an indicator aggregated to grid cells, for example, age
groups or the number of dwellings. When I talk about a
<em>category</em>, I talk about the discrete classifications of
features, e.g., ages 10 to 19, 20 to 29, 30 to 39, etc. You can retrieve
a list of all available features using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/z22_features.html">z22_features</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 55 × 8</span></span>
<span><span class="co">#&gt;    theme      feature            english                                german                z22   z11_100m z11_1km has_cat</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;chr&gt;                                  &lt;chr&gt;                 &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt;   &lt;lgl&gt;  </span></span>
<span><span class="co">#&gt;  1 Population population         Population                             Bevölkerung           TRUE  TRUE     TRUE    FALSE  </span></span>
<span><span class="co">#&gt;  2 Population citizens           Number of german citizens, 18 or older Deutsche Staatsangeh… TRUE  FALSE    FALSE   FALSE  </span></span>
<span><span class="co">#&gt;  3 Population foreigners         Share of foreigners                    Ausländeranteil       TRUE  FALSE    TRUE    FALSE  </span></span>
<span><span class="co">#&gt;  4 Population foreigners_from_18 Share of foreigners, 18 or older       Ausländeranteil ab 1… TRUE  FALSE    FALSE   FALSE  </span></span>
<span><span class="co">#&gt;  5 Population birth_country      Country of birth (groups)              Geburtsland (Gruppen) TRUE  TRUE     FALSE   TRUE   </span></span>
<span><span class="co">#&gt;  6 Population sex                Sex                                    Geschlecht            FALSE TRUE     FALSE   TRUE   </span></span>
<span><span class="co">#&gt;  7 Population women              Share of women                         Frauenanteil          FALSE FALSE    TRUE    FALSE  </span></span>
<span><span class="co">#&gt;  8 Population religion           Religion                               Religion              FALSE TRUE     FALSE   TRUE   </span></span>
<span><span class="co">#&gt;  9 Population citizenship        Citizenship                            Staatsangehörigkeit   TRUE  TRUE     FALSE   TRUE   </span></span>
<span><span class="co">#&gt; 10 Population citizenship_group  Citizenship (groups)                   Staatsangehörigkeit … TRUE  TRUE     FALSE   TRUE   </span></span>
<span><span class="co">#&gt; # ℹ 45 more rows</span></span></code></pre></div>
<p>Similarly, you can view a list of all categories for a feature.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/categories.html">z22_categories</a></span><span class="op">(</span><span class="st">"birth_country"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;    code german      english     </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1     1 Deutschland Germany     </span></span>
<span><span class="co">#&gt; 2    20 Ausland     Foreign     </span></span>
<span><span class="co">#&gt; 3    21 EU27-Land   EU27 country</span></span>
<span><span class="co">#&gt; 4    22 Europa      Europe      </span></span>
<span><span class="co">#&gt; 5    23 Welt        World       </span></span>
<span><span class="co">#&gt; 6    24 Sonstige    Other</span></span></code></pre></div>
<p>When I talk about <strong>grids</strong>, I mean a geographical grid
net according to the EU <a href="https://inspire.ec.europa.eu/theme/gg" class="external-link">INSPIRE</a> standard. Grids
always have a fixed resolution (100x100 m, 1x1 km, 10x10 km). Such grids
are useful to aggregate sensitive spatial data to a relatively detailed
level that is not as arbitrary as, e.g., municipality boundaries. You
can get a raw grid dataset based on the <a href="https://gdz.bkg.bund.de/index.php/default/inspire/sonstige-inspire-themen/geographische-gitter-fur-deutschland-in-lambert-projektion-geogitter-inspire.html" class="external-link">GeoGitter</a>
dataset using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_grid.html">z22_grid</a></span><span class="op">(</span><span class="st">"10km"</span>, as <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/vignette/unnamed-chunk-5-1.png" width="100%"></p>
<p>Although the data chunks are relatively small in size, downloading
grids and features again and again can take a while and strain internet
tariffs unnecessarily. That’s why data files are automatically cached,
i.e., if a file is downloaded again, it is simply read from the cache.
You can update stale cache files using the <code>update_cache</code>
argument.</p>
<p>To equip a raw raster with feature values, you can use the
<code>z22_data</code> function. Here, I download data on the type of
heating in buildings across Germany. Using <code>as = "raster"</code>, I
can convert the output to a <code>SpatRaster</code> from the
<a href="https://rspatial.org/" class="external-link">terra</a> package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_data.html">z22_data</a></span><span class="op">(</span><span class="st">"building_heat_type"</span>, res <span class="op">=</span> <span class="st">"10km"</span>, as <span class="op">=</span> <span class="st">"raster"</span><span class="op">)</span></span></code></pre></div>
<p>After rasterization, the results are returned in a
<code>SpatRasterDataset</code>, which is essentially a list of
<code>SpatRaster</code>s. To plot them, you can use the
<code>z22_pivot_longer</code> function to turn them to a long (and
facetable) table.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_pivot_longer.html">z22_pivot_longer</a></span><span class="op">(</span><span class="va">grid_ht</span>, <span class="st">"building_heat_type"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_ht</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">category</span>, nrow <span class="op">=</span> <span class="fl">2</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">35</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">3035</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Count"</span>, na.value <span class="op">=</span> <span class="st">"transparent"</span>, transform <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/vignette/multiplot-1.png" width="100%"></p>
<p>However, as you can see, we are dealing with absolute counts, which
makes the meaningfulness of the data questionable on its own. The
spatial patterns look very similar in each facet and mostly trace
spatial population patterns of Germany. To retrieve normalized (=
percentage) figures, we can use the <code>normalize</code> argument of
<code>z22_data</code>. Re-downloading the data should also take much
less time because the data files are still cached.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_data.html">z22_data</a></span><span class="op">(</span></span>
<span>  <span class="st">"building_heat_type"</span>,</span>
<span>  res <span class="op">=</span> <span class="st">"10km"</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"raster"</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<details><summary>
Code for the plot
</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_pivot_longer.html">z22_pivot_longer</a></span><span class="op">(</span><span class="va">grid_ht</span>, <span class="st">"building_heat_type"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_ht</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">category</span>, nrow <span class="op">=</span> <span class="fl">2</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">35</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">3035</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Share"</span>, na.value <span class="op">=</span> <span class="st">"transparent"</span>, transform <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/vignette/normalize_plot-1.png" width="100%"></p>
<p>By visualizing shares, we can observe that spatial differences are
not nearly as pronounced as the total numbers had us believe.
Particularly central heating is almost spatially homogeneous. Note that
the <code>normalize</code> argument is only sensible for features that
are counts.</p>
<p>There is one more issue that you can see in the map above. Some cells
are <code>NA</code> or entirely missing from the dataset and thus not
shown at all on the maps. These are cells where no observations can be
counted. In the case of heating, the issue is not as pressing but in
other cases the feature grid becomes a patchwork. Some marital statuses,
for example, are rarely seen in some areas of Germany.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_data.html">z22_data</a></span><span class="op">(</span></span>
<span>  <span class="st">"marital_status"</span>,</span>
<span>  categories <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  res <span class="op">=</span> <span class="st">"10km"</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"raster"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<details><summary>
Code for the plot
</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_pivot_longer.html">z22_pivot_longer</a></span><span class="op">(</span><span class="va">grid_ht</span>, <span class="st">"marital_status"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_ht</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">3035</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">category</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Count"</span>, na.value <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/vignette/patchwork_plot-1.png" width="100%"></p>
<p>To fill these gaps, you can request all cells using the
<code>all_cells</code> argument.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_data.html">z22_data</a></span><span class="op">(</span></span>
<span>  <span class="st">"marital_status"</span>,</span>
<span>  categories <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  res <span class="op">=</span> <span class="st">"10km"</span>,</span>
<span>  as <span class="op">=</span> <span class="st">"raster"</span>,</span>
<span>  all_cells <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in switch(as, raster = {: EXPR must be a length 1 vector</span></span></code></pre></div>
<details><summary>
Code for the plot
</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ht</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_pivot_longer.html">z22_pivot_longer</a></span><span class="op">(</span><span class="va">grid_ht</span>, <span class="st">"marital_status"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_ht</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">3035</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">category</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Count"</span>, na.value <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/vignette/allcells_plot-1.png" width="100%"></p>
<p>Working with 10x10 km grids is cool and all, but the census grids get
really exciting when looking at 100x100 m grids. Let’s, for example,
look at the average age distribution in the area of Berlin.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/z22_data.html">z22_data</a></span><span class="op">(</span><span class="st">"age_avg"</span>, res <span class="op">=</span> <span class="st">"100m"</span>, as <span class="op">=</span> <span class="st">"raster"</span>, all_cells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in switch(as, raster = {: EXPR must be a length 1 vector</span></span>
<span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4532432</span>, <span class="fl">4574087</span>, <span class="fl">3257338</span>, <span class="fl">3287499</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">berlin_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">grid_age</span><span class="op">$</span><span class="va">cat_0</span>, <span class="va">ext</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'crop': object 'grid_age' not found</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">berlin_age</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'berlin_age' not found</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonas Lieth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
